{
  "hash": "7d783c0743c6611438bf19cd8435d748",
  "result": {
    "markdown": "---\ntitle: \"Biodeposition analysis walk through\"\nformat: html\neditor: visual\n---\n\n\n## Summary:\n\nThis is a walk-through of the analysis to explain decisions we are considering and may make.\n\n## Field size relationships (biodeposition animals)\n\nFile setup\n\n\n\n\n::: {.cell}\n\n:::\n\n\nNote that in the following graph the relationship between DW and length is substantially different for the first cohort in Provincetown in September '22. Reproductive tissue was only \\~0.5% of tissue weight for the largest cohort with the greatest dry weight in June '23 so reproduction cannot account for these differences in condition. Given these differences, does length or DW more consistently scale with feeding in both field and lab conditions?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Length, y=Dry.weight, color = Month))+\n  geom_point(aes(shape=Treatment))+\n  facet_wrap(~ Site)\ngg1\n```\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Field Biodeposition\n\nFirst, let's look at OER and IER unscaled at each site. I'm pooling by treatment because treatment did not seem to have much of an effect, but biodeposition often differs by site and month\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Dry.weight, y=OER, color = Month))+\n  geom_point(aes(shape=Treatment))+\n  facet_wrap(~paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Dry.weight, y=IER, color = Month))+\n  geom_point(aes(shape=Treatment))+\n  facet_wrap(~ paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Length\n                             , y=OER, color = Month))+\n  geom_point(aes(shape=Treatment))+\n  facet_wrap(~paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Length\n                             , y=IER, color = Month))+\n  geom_point(aes(shape=Treatment))+\n  facet_wrap(~ paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n\nWe initially used a size-scaling coefficient of 0.76 from gill size relationships that a student of Shannon's had collected (see below graphs). It seems that CR decreases with size\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Dry.weight, y=CR\n                             , color = Month))+\n  geom_point(aes(shape=Treatment))+\n    stat_smooth(\n    method = 'nls',\n    formula = y ~ A * x^B,\n    method.args = list(start = c(A = 2.3, B = 2)),\n    se = FALSE\n  ) +\n  facet_wrap(~paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Length, y = CR\n                             , color = Month))+\n  geom_point(aes(shape=Treatment))+\n  stat_smooth(\n    method = 'nls',\n    formula = y ~ A * x^B,\n    method.args = list(start = c(A = 2.3, B = 2)),\n    se = FALSE\n  ) +\n  facet_wrap(~ paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Computation failed in `stat_smooth()`\nCaused by error in `method()`:\n! singular gradient\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Computation failed in `stat_smooth()`\nComputation failed in `stat_smooth()`\nComputation failed in `stat_smooth()`\nComputation failed in `stat_smooth()`\nCaused by error in `method()`:\n! number of iterations exceeded maximum of 50\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\nIn fact, if we fit all CR data using the same exponent but different coefficients, we initially got an exponent of -0.47. However, it looks like the main negative relationship is in Eel Pond in June, where half of the clams were collected from outside the cages. So I reran, excluding these surfclams in the first couple of code chunks, and this seems to resolve the issue: bd \\<- bd\\[bd\\$Treatment!=\"OUT\",\\]. Now the exponent is -.28.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit1 <- nlme::gnls(CR\n                   ~ A*(Dry.weight)^B,\n           params = list(A~paste(Site, Month)\n                         -1, B~1), \n           data=bd,\n           na.action = na.exclude,\n           start = list(A=c(1,1,1,1,1,1\n                            ), B = c(.3\n                                     ) ))\nsummary(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeneralized nonlinear least squares fit\n  Model: CR ~ A * (Dry.weight)^B \n  Data: bd \n       AIC      BIC    logLik\n  149.1801 165.8004 -66.59006\n\nCoefficients:\n                                                           Value Std.Error\nA.paste(Site, Month)Eel Pond Cohort 1 - Sep '22        1.6905773 0.4938805\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23      1.1143488 0.2973821\nA.paste(Site, Month)Eel Pond Cohort 2 - June '23       1.2520441 0.3320223\nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    2.1691043 0.4628177\nA.paste(Site, Month)Provincetown Cohort 2 - April '23  0.7181082 0.2979171\nA.paste(Site, Month)Provincetown Cohort 2 - June '23   0.4134373 0.2202734\nB                                                     -0.2864467 0.1747871\n                                                        t-value p-value\nA.paste(Site, Month)Eel Pond Cohort 1 - Sep '22        3.423049  0.0012\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23      3.747196  0.0004\nA.paste(Site, Month)Eel Pond Cohort 2 - June '23       3.770964  0.0004\nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    4.686736  0.0000\nA.paste(Site, Month)Provincetown Cohort 2 - April '23  2.410429  0.0195\nA.paste(Site, Month)Provincetown Cohort 2 - June '23   1.876928  0.0661\nB                                                     -1.638833  0.1073\n\n Correlation: \n                                                      AMPC1-S' AMPC2-A'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23      0.755           \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23       0.438    0.394  \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    0.867    0.781  \nA.paste(Site, Month)Provincetown Cohort 2 - April '23  0.138    0.124  \nA.paste(Site, Month)Provincetown Cohort 2 - June '23  -0.065   -0.059  \nB                                                      0.915    0.824  \n                                                      AMPC2-J' AMC1-S' AMC2-A'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23                             \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23                              \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    0.453                  \nA.paste(Site, Month)Provincetown Cohort 2 - April '23  0.072    0.143         \nA.paste(Site, Month)Provincetown Cohort 2 - June '23  -0.034   -0.068  -0.011 \nB                                                      0.478    0.947   0.151 \n                                                      AMC2-J'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23            \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23             \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22          \nA.paste(Site, Month)Provincetown Cohort 2 - April '23        \nA.paste(Site, Month)Provincetown Cohort 2 - June '23         \nB                                                     -0.071 \n\nStandardized residuals:\n        Min          Q1         Med          Q3         Max \n-1.84370458 -0.42416503 -0.04258293  0.51784586  3.22597040 \n\nResidual standard error: 0.7968039 \nDegrees of freedom: 59 total; 52 residual\n```\n:::\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Dry.weight, y = CR\n                             , color = Month))+\n  geom_point(aes(shape=Treatment))+\n  stat_smooth(\n    method = 'nls',\n    formula = y ~ A * x^-.29,\n    method.args = list(start = c(A = 2.3)),\n    se = FALSE\n  ) +\n  facet_wrap(~ paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\ngg1 <- ggplot(data = bd, aes(x=Length, y = CR\n                             , color = Month))+\n  geom_point(aes(shape=Treatment))+\n  stat_smooth(\n    method = 'nls',\n    formula = y ~ A * x^-.29,\n    method.args = list(start = c(A = 2.3)),\n    se = FALSE\n  ) +\n  facet_wrap(~ paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_smooth()`).\nRemoved 1 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\nQualitatively this looks fine. There are no negative relationships. But, if we test a linear vs. an exponential relationship, it seems that the exponential relationship significantly wins.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit1 <- nlme::gnls(CR\n                   ~ A*(Dry.weight)^B,\n           params = list(A~paste(Site, Month)\n                         -1, B~1), \n           data=bd,\n           na.action = na.exclude,\n           start = list(A=c(1,1,1,1,1,1\n                            ), B = c(.3\n                                     ) ))\nsummary(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeneralized nonlinear least squares fit\n  Model: CR ~ A * (Dry.weight)^B \n  Data: bd \n       AIC      BIC    logLik\n  149.1801 165.8004 -66.59006\n\nCoefficients:\n                                                           Value Std.Error\nA.paste(Site, Month)Eel Pond Cohort 1 - Sep '22        1.6905773 0.4938805\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23      1.1143488 0.2973821\nA.paste(Site, Month)Eel Pond Cohort 2 - June '23       1.2520441 0.3320223\nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    2.1691043 0.4628177\nA.paste(Site, Month)Provincetown Cohort 2 - April '23  0.7181082 0.2979171\nA.paste(Site, Month)Provincetown Cohort 2 - June '23   0.4134373 0.2202734\nB                                                     -0.2864467 0.1747871\n                                                        t-value p-value\nA.paste(Site, Month)Eel Pond Cohort 1 - Sep '22        3.423049  0.0012\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23      3.747196  0.0004\nA.paste(Site, Month)Eel Pond Cohort 2 - June '23       3.770964  0.0004\nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    4.686736  0.0000\nA.paste(Site, Month)Provincetown Cohort 2 - April '23  2.410429  0.0195\nA.paste(Site, Month)Provincetown Cohort 2 - June '23   1.876928  0.0661\nB                                                     -1.638833  0.1073\n\n Correlation: \n                                                      AMPC1-S' AMPC2-A'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23      0.755           \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23       0.438    0.394  \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    0.867    0.781  \nA.paste(Site, Month)Provincetown Cohort 2 - April '23  0.138    0.124  \nA.paste(Site, Month)Provincetown Cohort 2 - June '23  -0.065   -0.059  \nB                                                      0.915    0.824  \n                                                      AMPC2-J' AMC1-S' AMC2-A'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23                             \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23                              \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    0.453                  \nA.paste(Site, Month)Provincetown Cohort 2 - April '23  0.072    0.143         \nA.paste(Site, Month)Provincetown Cohort 2 - June '23  -0.034   -0.068  -0.011 \nB                                                      0.478    0.947   0.151 \n                                                      AMC2-J'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23            \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23             \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22          \nA.paste(Site, Month)Provincetown Cohort 2 - April '23        \nA.paste(Site, Month)Provincetown Cohort 2 - June '23         \nB                                                     -0.071 \n\nStandardized residuals:\n        Min          Q1         Med          Q3         Max \n-1.84370458 -0.42416503 -0.04258293  0.51784586  3.22597040 \n\nResidual standard error: 0.7968039 \nDegrees of freedom: 59 total; 52 residual\n```\n:::\n\n```{.r .cell-code}\nfit2 <- nlme::gnls(CR\n                   ~ A*(Dry.weight)+B,\n           params = list(A~paste(Site, Month)\n                         -1, B~1),\n           data=bd,\n           na.action = na.exclude,\n           start = list(A=c(1,1,1,1,1,1\n                            ),B = c(.3\n                                     ) ))\nsummary(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeneralized nonlinear least squares fit\n  Model: CR ~ A * (Dry.weight) + B \n  Data: bd \n       AIC     BIC    logLik\n  157.4727 174.093 -70.73633\n\nCoefficients:\n                                                          Value Std.Error\nA.paste(Site, Month)Eel Pond Cohort 1 - Sep '22       -0.250718 1.5565437\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23     -3.888276 1.5787317\nA.paste(Site, Month)Eel Pond Cohort 2 - June '23      -2.019836 1.0501761\nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    0.373729 1.4255014\nA.paste(Site, Month)Provincetown Cohort 2 - April '23 -2.587989 0.7499613\nA.paste(Site, Month)Provincetown Cohort 2 - June '23  -1.723683 0.3612868\nB                                                      2.716755 0.4361966\n                                                        t-value p-value\nA.paste(Site, Month)Eel Pond Cohort 1 - Sep '22       -0.161073  0.8727\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23     -2.462911  0.0171\nA.paste(Site, Month)Eel Pond Cohort 2 - June '23      -1.923330  0.0599\nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    0.262174  0.7942\nA.paste(Site, Month)Provincetown Cohort 2 - April '23 -3.450830  0.0011\nA.paste(Site, Month)Provincetown Cohort 2 - June '23  -4.770956  0.0000\nB                                                      6.228280  0.0000\n\n Correlation: \n                                                      AMPC1-S' AMPC2-A'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23      0.658           \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23       0.572    0.634  \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    0.684    0.758  \nA.paste(Site, Month)Provincetown Cohort 2 - April '23  0.598    0.663  \nA.paste(Site, Month)Provincetown Cohort 2 - June '23   0.684    0.758  \nB                                                     -0.770   -0.854  \n                                                      AMPC2-J' AMC1-S' AMC2-A'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23                             \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23                              \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22    0.659                  \nA.paste(Site, Month)Provincetown Cohort 2 - April '23  0.576    0.689         \nA.paste(Site, Month)Provincetown Cohort 2 - June '23   0.659    0.789   0.689 \nB                                                     -0.742   -0.888  -0.776 \n                                                      AMC2-J'\nA.paste(Site, Month)Eel Pond Cohort 2 - April '23            \nA.paste(Site, Month)Eel Pond Cohort 2 - June '23             \nA.paste(Site, Month)Provincetown Cohort 1 - Sep '22          \nA.paste(Site, Month)Provincetown Cohort 2 - April '23        \nA.paste(Site, Month)Provincetown Cohort 2 - June '23         \nB                                                     -0.888 \n\nStandardized residuals:\n       Min         Q1        Med         Q3        Max \n-2.0445728 -0.6428740 -0.1441277  0.5414478  3.3944104 \n\nResidual standard error: 0.8548144 \nDegrees of freedom: 59 total; 52 residual\n```\n:::\n\n```{.r .cell-code}\nAIC(fit1, fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     df      AIC\nfit1  8 149.1801\nfit2  8 157.4727\n```\n:::\n\n```{.r .cell-code}\nBIC(fit1, fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     df      BIC\nfit1  8 165.8004\nfit2  8 174.0930\n```\n:::\n:::\n\n\nI still don't think any of this is significant so I'm switching over to linear modeling because it's easier to do frequentist statistics with this method. Yes, this is not significant.\n\n## Redoing the scaling with length\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbd$CR_LenScaling <- bd$CR*(bd$Dry.weight^.76)/((bd$Length/10)^2.0)\n\ngg1 <- ggplot(data = bd, aes(x=Length, y = CR_LenScaling\n                             , color = Month))+\n  geom_point(aes(shape=Treatment))+\n  stat_smooth(\n    method = 'nls',\n    formula = y ~ A * x^B,\n    method.args = list(start = c(A = 2.3, B = 2)),\n    se = FALSE\n  ) +\n  facet_wrap(~ paste(Site, Month))\n\ngg1\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Computation failed in `stat_smooth()`\nComputation failed in `stat_smooth()`\nComputation failed in `stat_smooth()`\nComputation failed in `stat_smooth()`\nComputation failed in `stat_smooth()`\nCaused by error in `method()`:\n! number of iterations exceeded maximum of 50\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Biodeposition_summary_size_scaling_walkthrough_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Biodeposition_summary_size_scaling_walkthrough_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}